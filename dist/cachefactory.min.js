/*!
* cachefactory
* @version 1.2.0 - Homepage <http://jmdobry.github.io/cachefactory/>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2013-2015 Jason Dobry <http://www.pseudobry.com>
* @license MIT <https://github.com/jmdobry/cachefactory/blob/master/LICENSE>
*
* @overview cachefactory is a very useful replacement for Angular's $cacheFactory.
*/

!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.CacheFactory=b():a.CacheFactory=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){return w(a,b)}var g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(1),j=null;try{j=window.Promise}catch(k){}var l={isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isObject:function(a){return null!==a&&"object"==typeof a},isFunction:function(a){return"function"==typeof a},fromJson:function(a){return JSON.parse(a)},equals:function(a,b){return a===b},Promise:j},m=function(a){var b=[],c=void 0;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},n=function(a){return a&&"function"==typeof a.then},o=function(a){return l.isNumber(a)?a.toString():a},p=function(a){var b={},c=void 0;for(c in a)a.hasOwnProperty(c)&&(b[c]=c);return b},q=function(){function a(){e(this,a),this.$$lruHeap=new i(function(a){return a.accessed},l.equals)}return h(a,[{key:"priorityQueue",value:function(){return this.$$lruHeap}}]),a}(),r=function(a){function b(){e(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).call(this)}return d(b,a),h(b,[{key:"onGet",value:function(a,b){var c=Date.now();return this.$$lruHeap.remove(b),b.accessed=c,this.$$lruHeap.push(b),!0}},{key:"onPut",value:function(a,b){this.$$lruHeap.push(b)}},{key:"onRemove",value:function(a,b){this.$$lruHeap.remove(b)}}]),b}(q),s=function(a){function b(){e(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).call(this)}return d(b,a),h(b,[{key:"onGet",value:function(a,b){var c=Date.now();return this.$$lruHeap.remove({key:a,accessed:b.accessed}),b.accessed=c,this.$$lruHeap.push({key:a,accessed:c}),!0}},{key:"onPut",value:function(a,b){this.$$lruHeap.push({key:a,accessed:b.accessed})}},{key:"onRemove",value:function(a,b){this.$$lruHeap.remove({key:a,accessed:b.accessed})}}]),b}(q),t={"default":function(){return new r},withStorage:function(){return new s}},u={capacity:Number.MAX_VALUE,maxAge:Number.MAX_VALUE,deleteOnExpire:"none",onExpire:null,cacheFlushInterval:null,recycleFreq:1e3,storageMode:"memory",storageImpl:null,disabled:!1,storagePrefix:"cachefactory.caches.",storeOnResolve:!1,storeOnReject:!1,replacementStrategy:t},v={},w=function(a,b){if(a in v)throw new Error(a+" already exists!");if(!l.isString(a))throw new Error("cacheId must be a string!");var c={},d={},e=null,f=null,g=new i(function(a){return a.expires},l.equals),h=v[a]={$$id:a,destroy:function(){clearInterval(this.$$cacheFlushIntervalId),clearInterval(this.$$recycleFreqId),this.removeAll(),e&&(e().removeItem(this.$$prefix+".keys"),e().removeItem(this.$$prefix)),e=null,c=null,f=null,g=null,this.$$prefix=null,delete v[this.$$id]},disable:function(){this.$$disabled=!0},enable:function(){delete this.$$disabled},get:function(a,b){var c=this;if(Array.isArray(a)){var d=function(){var d=a,e=[];return d.forEach(function(a){var d=c.get(a,b);null!==d&&void 0!==d&&e.push(d)}),{v:e}}();if("object"==typeof d)return d.v}else if(a=o(a),this.$$disabled)return;if(b=b||{},!l.isString(a))throw new Error("key must be a string!");if(b&&!l.isObject(b))throw new Error("options must be an object!");if(b.onExpire&&!l.isFunction(b.onExpire))throw new Error("options.onExpire must be a function!");var g=this.doGetItem(a);if(!g||n(g))return g;var h=f.onGet(a,g),i=g.value;return"passive"===this.$$deleteOnExpire&&"expires"in g&&g.expires<Date.now()?(this.remove(a),this.$$onExpire?this.$$onExpire.call(this,a,g.value,b.onExpire):b.onExpire&&b.onExpire.call(this,a,g.value),i=void 0):e&&h&&e().setItem(this.$$prefix+".data."+a,JSON.stringify(g)),i},info:function(a){if(a){var b=void 0;if(e){var d=e().getItem(this.$$prefix+".data."+a);return d?(b=l.fromJson(d),{created:b.created,accessed:b.accessed,expires:b.expires,isExpired:(new Date).getTime()-b.created>(b.maxAge||this.$$maxAge)}):void 0}return a in c?(b=c[a],{created:b.created,accessed:b.accessed,expires:b.expires,isExpired:(new Date).getTime()-b.created>(b.maxAge||this.$$maxAge)}):void 0}return{id:this.$$id,capacity:this.$$capacity,maxAge:this.$$maxAge,deleteOnExpire:this.$$deleteOnExpire,onExpire:this.$$onExpire,cacheFlushInterval:this.$$cacheFlushInterval,recycleFreq:this.$$recycleFreq,storageMode:this.$$storageMode,storageImpl:e?e():void 0,disabled:!!this.$$disabled,size:f&&f.priorityQueue().size()||0}},keys:function(){if(e){var a=e().getItem(this.$$prefix+".keys");return a?l.fromJson(a):[]}return m(c)},keySet:function(){if(e){var a=e().getItem(this.$$prefix+".keys"),b={};if(a)for(var d=l.fromJson(a),f=0;f<d.length;f++)b[d[f]]=d[f];return b}return p(c)},put:function(a,b,h){var i=this;h=h||{};var j="storeOnResolve"in h?!!h.storeOnResolve:this.$$storeOnResolve,k="storeOnReject"in h?!!h.storeOnReject:this.$$storeOnReject,m=function(b,c){return function(e){if(b&&(delete d[a],l.isObject(e)&&"status"in e&&"data"in e?(e=[e.status,e.data,e.headers(),e.statusText],i.put(a,e)):i.put(a,e)),c){if(l.Promise)return l.Promise.reject(e);throw e}return e}};if(!this.$$disabled&&null!==b&&void 0!==b){if(a=o(a),!l.isString(a))throw new Error("key must be a string!");var p=(new Date).getTime(),q={key:a,value:n(b)?b.then(m(j,!1),m(k,!0)):b,created:p,accessed:p};if(h.maxAge&&(q.maxAge=h.maxAge),q.expires=q.created+(q.maxAge||this.$$maxAge),e){if(n(q.value))return d[a]=q.value,d[a];var r=e().getItem(this.$$prefix+".keys"),s=r?l.fromJson(r):[],t=e().getItem(this.$$prefix+".data."+a);t&&this.remove(a),g.push({key:a,expires:q.expires}),f.onPut(a,q),e().setItem(this.$$prefix+".data."+a,JSON.stringify(q));for(var u=!1,v=0;v<s.length;v++)if(s[v]===a){u=!0;break}u||s.push(a),e().setItem(this.$$prefix+".keys",JSON.stringify(s))}else c[a]&&this.remove(a),g.push(q),f.onPut(a,q),c[a]=q,delete d[a];var w=f.priorityQueue();return w.size()>this.$$capacity&&this.remove(w.peek().key),b}},remove:function(a){if(a+="",delete d[a],!e){var b=c[a]?c[a].value:void 0;return f.onRemove(a,c[a]),g.remove(c[a]),c[a]=null,delete c[a],b}var h=e().getItem(this.$$prefix+".data."+a);if(h){var i=l.fromJson(h);f.onRemove(a,i),g.remove({key:a,expires:i.expires}),e().removeItem(this.$$prefix+".data."+a);var j=e().getItem(this.$$prefix+".keys"),k=j?l.fromJson(j):[],m=k.indexOf(a);return m>=0&&k.splice(m,1),e().setItem(this.$$prefix+".keys",JSON.stringify(k)),i.value}},removeAll:function(){if(f&&f.priorityQueue().removeAll(),g.removeAll(),e){var a=e().getItem(this.$$prefix+".keys");if(a)for(var b=l.fromJson(a),h=0;h<b.length;h++)this.remove(b[h]);e().setItem(this.$$prefix+".keys",JSON.stringify([]))}else{for(var i in c)c[i]=null;c={}}d={}},removeExpired:function(){for(var a=(new Date).getTime(),b={},c=void 0,d=void 0;(d=g.peek())&&d.expires<=a;)b[d.key]=d.value?d.value:null,g.pop();if(e)for(c in b){var f=e().getItem(this.$$prefix+".data."+c);f&&(b[c]=l.fromJson(f).value,this.remove(c))}else for(c in b)this.remove(c);if(this.$$onExpire)for(c in b)this.$$onExpire.call(this,c,b[c]);return b},setCacheFlushInterval:function(a){if(null===a)delete this.$$cacheFlushInterval;else{if(!l.isNumber(a))throw new Error("cacheFlushInterval must be a number!");if(0>a)throw new Error("cacheFlushInterval must be greater than zero!");a!==this.$$cacheFlushInterval&&(this.$$cacheFlushInterval=a,clearInterval(this.$$cacheFlushIntervalId),function(a){a.$$cacheFlushIntervalId=setInterval(function(){a.removeAll()},a.$$cacheFlushInterval)}(this))}},setCapacity:function(a){if(null===a)delete this.$$capacity;else{if(!l.isNumber(a))throw new Error("capacity must be a number!");if(0>a)throw new Error("capacity must be greater than zero!");this.$$capacity=a}for(var b={},c=f.priorityQueue();c.size()>this.$$capacity;)b[c.peek().key]=this.remove(c.peek().key);return b},setDeleteOnExpire:function(a,b){if(null===a)delete this.$$deleteOnExpire;else{if(!l.isString(a))throw new Error("deleteOnExpire must be a string!");if("none"!==a&&"passive"!==a&&"aggressive"!==a)throw new Error('deleteOnExpire must be "none", "passive" or "aggressive"!');this.$$deleteOnExpire=a}b!==!1&&this.setRecycleFreq(this.$$recycleFreq)},setMaxAge:function(a){if(null===a)this.$$maxAge=Number.MAX_VALUE;else{if(!l.isNumber(a))throw new Error("maxAge must be a number!");if(0>a)throw new Error("maxAge must be greater than zero!");this.$$maxAge=a}var b=void 0,d=void 0,f=void 0;if(g.removeAll(),e){var h=e().getItem(this.$$prefix+".keys");for(d=h?l.fromJson(h):[],b=0;b<d.length;b++){f=d[b];var i=e().getItem(this.$$prefix+".data."+f);if(i){var j=l.fromJson(i);this.$$maxAge===Number.MAX_VALUE?j.expires=Number.MAX_VALUE:j.expires=j.created+(j.maxAge||this.$$maxAge),g.push({key:f,expires:j.expires})}}}else for(d=m(c),b=0;b<d.length;b++)f=d[b],this.$$maxAge===Number.MAX_VALUE?c[f].expires=Number.MAX_VALUE:c[f].expires=c[f].created+(c[f].maxAge||this.$$maxAge),g.push(c[f]);return"aggressive"===this.$$deleteOnExpire?this.removeExpired():{}},setOnExpire:function(a){if(null===a)delete this.$$onExpire;else{if(!l.isFunction(a))throw new Error("onExpire must be a function!");this.$$onExpire=a}},setOptions:function(a,b){if(a=a||{},b=!!b,!l.isObject(a))throw new Error("cacheOptions must be an object!");"storagePrefix"in a?this.$$storagePrefix=a.storagePrefix:b&&(this.$$storagePrefix=u.storagePrefix),this.$$prefix=this.$$storagePrefix+this.$$id,"disabled"in a?this.$$disabled=!!a.disabled:b&&(this.$$disabled=u.disabled),"storageMode"in a||"storageImpl"in a?this.setStorageMode(a.storageMode||u.storageMode,a.storageImpl||u.storageImpl,a.replacementStrategy||u.replacementStrategy):b&&this.setStorageMode(u.storageMode,u.storageImpl,u.replacementStrategy),"storeOnResolve"in a?this.$$storeOnResolve=!!a.storeOnResolve:b&&(this.$$storeOnResolve=u.storeOnResolve),"storeOnReject"in a?this.$$storeOnReject=!!a.storeOnReject:b&&(this.$$storeOnReject=u.storeOnReject),"capacity"in a?this.setCapacity(a.capacity):b&&this.setCapacity(u.capacity),"deleteOnExpire"in a?this.setDeleteOnExpire(a.deleteOnExpire,!1):b&&this.setDeleteOnExpire(u.deleteOnExpire,!1),"maxAge"in a?this.setMaxAge(a.maxAge):b&&this.setMaxAge(u.maxAge),"recycleFreq"in a?this.setRecycleFreq(a.recycleFreq):b&&this.setRecycleFreq(u.recycleFreq),"cacheFlushInterval"in a?this.setCacheFlushInterval(a.cacheFlushInterval):b&&this.setCacheFlushInterval(u.cacheFlushInterval),"onExpire"in a?this.setOnExpire(a.onExpire):b&&this.setOnExpire(u.onExpire)},setRecycleFreq:function(a){if(null===a)delete this.$$recycleFreq;else{if(!l.isNumber(a))throw new Error("recycleFreq must be a number!");if(0>a)throw new Error("recycleFreq must be greater than zero!");this.$$recycleFreq=a}clearInterval(this.$$recycleFreqId),"aggressive"===this.$$deleteOnExpire?!function(a){a.$$recycleFreqId=setInterval(function(){a.removeExpired()},a.$$recycleFreq)}(this):delete this.$$recycleFreqId},doGetItem:function(a){if(e){if(d[a])return d[a];var b=e().getItem(this.$$prefix+".data."+a);return b?l.fromJson(b):void 0}if(a in c)return c[a]},setStorageMode:function(a,b,c){if(!l.isString(a))throw new Error("storageMode must be a string!");if("memory"!==a&&"localStorage"!==a&&"sessionStorage"!==a)throw new Error('storageMode must be "memory", "localStorage" or "sessionStorage"!');var d=!1,h={};if("string"==typeof this.$$storageMode&&this.$$storageMode!==a){var i=this.keys();if(i.length){for(var j=0;j<i.length;j++)h[i[j]]=this.get(i[j]);for(j=0;j<i.length;j++)this.remove(i[j]);d=!0}}if(this.$$storageMode=a,b){if(!l.isObject(b))throw new Error("storageImpl must be an object!");if(!("setItem"in b&&"function"==typeof b.setItem))throw new Error('storageImpl must implement "setItem(key, value)"!');if(!("getItem"in b&&"function"==typeof b.getItem))throw new Error('storageImpl must implement "getItem(key)"!');if(!("removeItem"in b)||"function"!=typeof b.removeItem)throw new Error('storageImpl must implement "removeItem(key)"!');e=function(){return b}}else if("localStorage"===this.$$storageMode)try{localStorage.setItem("cachefactory","cachefactory"),localStorage.removeItem("cachefactory"),e=function(){return localStorage}}catch(k){e=null,this.$$storageMode="memory"}else if("sessionStorage"===this.$$storageMode)try{sessionStorage.setItem("cachefactory","cachefactory"),sessionStorage.removeItem("cachefactory"),e=function(){return sessionStorage}}catch(k){e=null,this.$$storageMode="memory"}if(f=e?c.withStorage():c["default"](),d)for(var m in h)this.put(m,h[m]);else if(e){var i=this.keys();if(i.length)for(var n=0;n<i.length;n++){var o=i[n],p=this.doGetItem(o);f.onPut(o,p),g.push({key:o,expires:p.expires})}}},touch:function(a){var b=this;if(a){var c=this.get(a,{onExpire:function(a,c){return b.put(a,c)}});c&&this.put(a,c)}else for(var d=this.keys(),e=0;e<d.length;e++)this.touch(d[e])}};return h.setOptions(b,!0),h};f.createCache=w,f.defaults=u,f.info=function(){var a=m(v),b={size:a.length,caches:{}};for(var c in u)u.hasOwnProperty(c)&&(b[c]=u[c]);for(var d=0;d<a.length;d++){var e=a[d];b.caches[e]=v[e].info()}return b},f.get=function(a){return v[a]},f.keySet=function(){return p(v)},f.keys=function(){return m(v)},f.destroy=function(a){v[a]&&(v[a].destroy(),delete v[a])},f.destroyAll=function(){for(var a in v)v[a].destroy();v={}},f.clearAll=function(){for(var a in v)v[a].removeAll()},f.removeExpiredFromAll=function(){var a={};for(var b in v)a[b]=v[b].removeExpired();return a},f.enableAll=function(){for(var a in v)v[a].$$disabled=!1},f.disableAll=function(){for(var a in v)v[a].$$disabled=!0},f.touchAll=function(){for(var a in v)v[a].touch()},f.utils=l,f.BinaryHeap=i,a.exports=f},function(a,b,c){!function(b,c){a.exports=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b,c){for(var d=a[c],e=b(d);c>0;){var f=Math.floor((c+1)/2)-1,g=a[f];if(e>=b(g))break;a[f]=d,a[c]=g,c=f}}function e(a,b){if(a||(a=function(a){return a}),b||(b=function(a,b){return a===b}),"function"!=typeof a)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "weightFunc" must be a function!');if("function"!=typeof b)throw new Error('BinaryHeap([weightFunc][, compareFunc]): "compareFunc" must be a function!');this.weightFunc=a,this.compareFunc=b,this.heap=[]}var f=function(a,b,c){for(var d=a.length,e=a[c],f=b(e);;){var g=2*(c+1),h=g-1,i=null;if(d>h){var j=a[h],k=b(j);f>k&&(i=h)}if(d>g){var l=a[g],m=b(l);m<(null===i?f:b(a[h]))&&(i=g)}if(null===i)break;a[c]=a[i],a[i]=e,c=i}},g=e.prototype;g.push=function(a){this.heap.push(a),d(this.heap,this.weightFunc,this.heap.length-1)},g.peek=function(){return this.heap[0]},g.pop=function(){var a=this.heap[0],b=this.heap.pop();return this.heap.length>0&&(this.heap[0]=b,f(this.heap,this.weightFunc,0)),a},g.remove=function(a){for(var b=this.heap.length,c=0;b>c;c++)if(this.compareFunc(this.heap[c],a)){var e=this.heap[c],g=this.heap.pop();return c!==b-1&&(this.heap[c]=g,d(this.heap,this.weightFunc,c),f(this.heap,this.weightFunc,c)),e}return null},g.removeAll=function(){this.heap=[]},g.size=function(){return this.heap.length},a.exports=e}])})}])});
//# sourceMappingURL=cachefactory.min.map